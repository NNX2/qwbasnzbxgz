local UserInputService = game:GetService("UserInputService")
local Players = game:GetService("Players")

local player = Players.LocalPlayer
local vehicle = nil -- Initialisation de la variable du véhicule
local flying = false
local originalSpeed = 20 -- Vitesse originale du véhicule
local boostedSpeed = 30 -- Vitesse augmentée en mode vol

-- Fonction pour assurer que BodyVelocity existe
local function ensureBodyVelocity(vehicle)
    if not vehicle:FindFirstChild("BodyVelocity") then
        local bv = Instance.new("BodyVelocity")
        bv.Parent = vehicle
    end
end

-- Fonction pour activer ou désactiver le vol
local function toggleFlight()
    if not vehicle then
        print("Aucun véhicule détecté")
        return
    end

    ensureBodyVelocity(vehicle)  -- S'assurer que BodyVelocity existe
    flying = not flying
    local bv = vehicle:FindFirstChild("BodyVelocity")
    
    if flying then
        bv.Velocity = Vector3.new(0, 20, 0)
        bv.MaxForce = Vector3.new(0, 400000, 0)
        if vehicle:FindFirstChild("Configuration") and vehicle.Configuration:FindFirstChild("Speed") then
            vehicle.Configuration.Speed.Value = boostedSpeed
        end
    else
        bv.Velocity = Vector3.new(0, 0, 0)
        bv.MaxForce = Vector3.new(0, 0, 0)
        if vehicle:FindFirstChild("Configuration") and vehicle.Configuration:FindFirstChild("Speed") then
            vehicle.Configuration.Speed.Value = originalSpeed
        end
    end
end

-- Écouter les changements dans les sièges des véhicules
local function checkSeat()
    local vehicles = game.Workspace.Vehicles
    for _, v in pairs(vehicles:GetChildren()) do
        if v:IsA("Model") and v:FindFirstChild("Seat") then
            local seat = v.Seat
            if seat.Occupant and seat.Occupant.Parent == player.Character then
                vehicle = v
                break
            else
                vehicle = nil
            end
        end
    end
end

-- Vérifie continuellement le siège
game:GetService("RunService").Heartbeat:Connect(checkSeat)

-- Écouter l'appui sur la touche "y"
UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
    if not gameProcessedEvent and input.KeyCode == Enum.KeyCode.Y then
        toggleFlight()
    end
end)
